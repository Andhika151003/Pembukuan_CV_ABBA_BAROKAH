<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="ABBABAROKAH.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="0"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="20061"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="BiayaPemasaran" custom_title="0" dock_id="1" table="4,14:mainBiayaPemasaran"/><dock_state state="000000ff00000000fd000000010000000200000774000003b8fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000007740000011b00ffffff000002580000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Administrasi" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="50"/><column index="3" value="110"/><column index="4" value="58"/><column index="5" value="203"/><column index="6" value="72"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="BiayaPemasaran" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="226"/><column index="3" value="159"/><column index="4" value="184"/><column index="5" value="140"/><column index="6" value="97"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="HargaPokokPenjualan" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="50"/><column index="3" value="63"/><column index="4" value="90"/><column index="5" value="68"/><column index="6" value="71"/><column index="7" value="60"/><column index="8" value="85"/><column index="9" value="73"/><column index="10" value="72"/><column index="11" value="82"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Modal" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="50"/><column index="3" value="76"/><column index="4" value="47"/><column index="5" value="87"/><column index="6" value="72"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Pembayaran" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="126"/><column index="3" value="123"/><column index="4" value="126"/><column index="5" value="72"/><column index="6" value="82"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="PembelianInventaris" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="87"/><column index="3" value="97"/><column index="4" value="85"/><column index="5" value="47"/><column index="6" value="46"/><column index="7" value="85"/><column index="8" value="84"/><column index="9" value="73"/><column index="10" value="126"/><column index="11" value="107"/><column index="12" value="72"/><column index="13" value="115"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Penjualan" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="207"/><column index="3" value="112"/><column index="4" value="98"/><column index="5" value="105"/><column index="6" value="96"/><column index="7" value="126"/><column index="8" value="118"/><column index="9" value="72"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="PersediaanBarang" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="50"/><column index="3" value="85"/><column index="4" value="46"/><column index="5" value="93"/><column index="6" value="47"/><column index="7" value="85"/><column index="8" value="72"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="ReturPembelian" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="122"/><column index="3" value="85"/><column index="4" value="82"/><column index="5" value="79"/><column index="6" value="106"/><column index="7" value="77"/><column index="8" value="85"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="ReturPenjualan" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="57"/><column index="3" value="85"/><column index="4" value="82"/><column index="5" value="79"/><column index="6" value="106"/><column index="7" value="77"/><column index="8" value="120"/><column index="9" value="136"/><column index="10" value="82"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="SetorPajak" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="86"/><column index="3" value="73"/><column index="4" value="85"/><column index="5" value="62"/><column index="6" value="72"/><column index="7" value="82"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="User" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="63"/><column index="3" value="300"/><column index="4" value="54"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="UtangUsaha" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="29"/><column index="2" value="61"/><column index="3" value="90"/><column index="4" value="129"/><column index="5" value="86"/><column index="6" value="95"/><column index="7" value="82"/><column index="8" value="72"/><column index="9" value="85"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="master_jurnal" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="60"/><column index="2" value="258"/><column index="3" value="244"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_laporan_laba_rugi" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="41"/><column index="2" value="96"/><column index="3" value="131"/><column index="4" value="107"/><column index="5" value="62"/><column index="6" value="68"/><column index="7" value="113"/><column index="8" value="106"/><column index="9" value="72"/><column index="10" value="142"/><column index="11" value="73"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_neraca_keuangan" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="62"/><column index="2" value="91"/><column index="3" value="115"/><column index="4" value="108"/><column index="5" value="73"/><column index="6" value="88"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">CREATE VIEW v_laporan_laba_rugi AS
SELECT
    strftime('%Y', p.tanggal_penjualan) AS tahun,

    /* =====================
       PENDAPATAN
       ===================== */

    IFNULL(SUM(p.total_penjualan), 0) AS total_penjualan,

    (
        SELECT IFNULL(SUM(rj.jumlah_retur), 0)
        FROM ReturPenjualan rj
        WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
    ) AS total_retur_penjualan,

    (
        IFNULL(SUM(p.total_penjualan), 0) -
        (
            SELECT IFNULL(SUM(rj.jumlah_retur), 0)
            FROM ReturPenjualan rj
            WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
        )
    ) AS total_pendapatan,

    /* =====================
       HPP
       ===================== */

    (
        SELECT IFNULL(SUM(hpp.total_harga), 0)
        FROM HargaPokokPenjualan hpp
        WHERE strftime('%Y', hpp.tanggal) = strftime('%Y', p.tanggal_penjualan)
    ) AS total_hpp,

    /* =====================
       LABA KOTOR
       ===================== */

    (
        (
            IFNULL(SUM(p.total_penjualan), 0) -
            (
                SELECT IFNULL(SUM(rj.jumlah_retur), 0)
                FROM ReturPenjualan rj
                WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
            )
        )
        -
        (
            SELECT IFNULL(SUM(hpp.total_harga), 0)
            FROM HargaPokokPenjualan hpp
            WHERE strftime('%Y', hpp.tanggal) = strftime('%Y', p.tanggal_penjualan)
        )
    ) AS laba_kotor,

    /* =====================
       BIAYA OPERASIONAL
       ===================== */

    (
        SELECT IFNULL(SUM(a.jumlah_administrasi), 0)
        FROM Administrasi a
        WHERE strftime('%Y', a.tanggal) = strftime('%Y', p.tanggal_penjualan)
    ) AS biaya_administrasi,

    (
        SELECT IFNULL(SUM(bp.jumlah_pemasaran), 0)
        FROM BiayaPemasaran bp
        WHERE strftime('%Y', bp.tanggal) = strftime('%Y', p.tanggal_penjualan)
    ) AS biaya_pemasaran,

    (
        SELECT IFNULL(SUM(sp.jumlah_pajak), 0)
        FROM SetorPajak sp
        WHERE strftime('%Y', sp.tanggal_setor) = strftime('%Y', p.tanggal_penjualan)
    ) AS total_pajak,

    /* =====================
       TOTAL BIAYA OPERASIONAL
       ===================== */

    (
        (
            SELECT IFNULL(SUM(a.jumlah_administrasi), 0)
            FROM Administrasi a
            WHERE strftime('%Y', a.tanggal) = strftime('%Y', p.tanggal_penjualan)
        )
        +
        (
            SELECT IFNULL(SUM(bp.jumlah_pemasaran), 0)
            FROM BiayaPemasaran bp
            WHERE strftime('%Y', bp.tanggal) = strftime('%Y', p.tanggal_penjualan)
        )
        +
        (
            SELECT IFNULL(SUM(sp.jumlah_pajak), 0)
            FROM SetorPajak sp
            WHERE strftime('%Y', sp.tanggal_setor) = strftime('%Y', p.tanggal_penjualan)
        )
    ) AS total_biaya_operasional,

    /* =====================
       LABA BERSIH
       ===================== */

    (
        (
            (
                IFNULL(SUM(p.total_penjualan), 0) -
                (
                    SELECT IFNULL(SUM(rj.jumlah_retur), 0)
                    FROM ReturPenjualan rj
                    WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
                )
            )
            -
            (
                SELECT IFNULL(SUM(hpp.total_harga), 0)
                FROM HargaPokokPenjualan hpp
                WHERE strftime('%Y', hpp.tanggal) = strftime('%Y', p.tanggal_penjualan)
            )
        )
        -
        (
            (
                SELECT IFNULL(SUM(a.jumlah_administrasi), 0)
                FROM Administrasi a
                WHERE strftime('%Y', a.tanggal) = strftime('%Y', p.tanggal_penjualan)
            )
            +
            (
                SELECT IFNULL(SUM(bp.jumlah_pemasaran), 0)
                FROM BiayaPemasaran bp
                WHERE strftime('%Y', bp.tanggal) = strftime('%Y', p.tanggal_penjualan)
            )
            +
            (
                SELECT IFNULL(SUM(sp.jumlah_pajak), 0)
                FROM SetorPajak sp
                WHERE strftime('%Y', sp.tanggal_setor) = strftime('%Y', p.tanggal_penjualan)
            )
        )
    ) AS laba_bersih

FROM Penjualan p
GROUP BY strftime('%Y', p.tanggal_penjualan);
</sql><sql name="Sunting View v_laporan_laba_rugi*">CREATE VIEW v_laporan_laba_rugi AS
SELECT
    strftime('%Y', p.tanggal_penjualan) AS tahun,

    /* =====================
       PENDAPATAN
       ===================== */

    IFNULL(SUM(p.total_penjualan), 0) AS total_penjualan,

    (
        SELECT IFNULL(SUM(rj.jumlah_retur), 0)
        FROM ReturPenjualan rj
        WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
    ) AS total_retur_penjualan,

    (
        IFNULL(SUM(p.total_penjualan), 0) -
        (
            SELECT IFNULL(SUM(rj.jumlah_retur), 0)
            FROM ReturPenjualan rj
            WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
        )
    ) AS total_pendapatan,

    /* =====================
       HPP
       ===================== */

    (
        SELECT IFNULL(SUM(hpp.total_harga), 0)
        FROM HargaPokokPenjualan hpp
        WHERE strftime('%Y', hpp.tanggal) = strftime('%Y', p.tanggal_penjualan)
    ) AS total_hpp,

    /* =====================
       LABA KOTOR
       ===================== */

    (
        (
            IFNULL(SUM(p.total_penjualan), 0) -
            (
                SELECT IFNULL(SUM(rj.jumlah_retur), 0)
                FROM ReturPenjualan rj
                WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
            )
        )
        -
        (
            SELECT IFNULL(SUM(hpp.total_harga), 0)
            FROM HargaPokokPenjualan hpp
            WHERE strftime('%Y', hpp.tanggal) = strftime('%Y', p.tanggal_penjualan)
        )
    ) AS laba_kotor,

    /* =====================
       BIAYA OPERASIONAL
       ===================== */

    (
        SELECT IFNULL(SUM(a.jumlah_administrasi), 0)
        FROM Administrasi a
        WHERE strftime('%Y', a.tanggal) = strftime('%Y', p.tanggal_penjualan)
    ) AS biaya_administrasi,

    (
        SELECT IFNULL(SUM(bp.jumlah_pemasaran), 0)
        FROM BiayaPemasaran bp
        WHERE strftime('%Y', bp.tanggal) = strftime('%Y', p.tanggal_penjualan)
    ) AS biaya_pemasaran,

    (
        SELECT IFNULL(SUM(sp.jumlah_pajak), 0)
        FROM SetorPajak sp
        WHERE strftime('%Y', sp.tanggal_setor) = strftime('%Y', p.tanggal_penjualan)
    ) AS total_pajak,

    /* =====================
       TOTAL BIAYA OPERASIONAL
       ===================== */

    (
        (
            SELECT IFNULL(SUM(a.jumlah_administrasi), 0)
            FROM Administrasi a
            WHERE strftime('%Y', a.tanggal) = strftime('%Y', p.tanggal_penjualan)
        )
        +
        (
            SELECT IFNULL(SUM(bp.jumlah_pemasaran), 0)
            FROM BiayaPemasaran bp
            WHERE strftime('%Y', bp.tanggal) = strftime('%Y', p.tanggal_penjualan)
        )
        +
        (
            SELECT IFNULL(SUM(sp.jumlah_pajak), 0)
            FROM SetorPajak sp
            WHERE strftime('%Y', sp.tanggal_setor) = strftime('%Y', p.tanggal_penjualan)
        )
    ) AS total_biaya_operasional,

    /* =====================
       LABA BERSIH
       ===================== */

    (
        (
            (
                IFNULL(SUM(p.total_penjualan), 0) -
                (
                    SELECT IFNULL(SUM(rj.jumlah_retur), 0)
                    FROM ReturPenjualan rj
                    WHERE strftime('%Y', rj.tanggal_retur) = strftime('%Y', p.tanggal_penjualan)
                )
            )
            -
            (
                SELECT IFNULL(SUM(hpp.total_harga), 0)
                FROM HargaPokokPenjualan hpp
                WHERE strftime('%Y', hpp.tanggal) = strftime('%Y', p.tanggal_penjualan)
            )
        )
        -
        (
            (
                SELECT IFNULL(SUM(a.jumlah_administrasi), 0)
                FROM Administrasi a
                WHERE strftime('%Y', a.tanggal) = strftime('%Y', p.tanggal_penjualan)
            )
            +
            (
                SELECT IFNULL(SUM(bp.jumlah_pemasaran), 0)
                FROM BiayaPemasaran bp
                WHERE strftime('%Y', bp.tanggal) = strftime('%Y', p.tanggal_penjualan)
            )
            +
            (
                SELECT IFNULL(SUM(sp.jumlah_pajak), 0)
                FROM SetorPajak sp
                WHERE strftime('%Y', sp.tanggal_setor) = strftime('%Y', p.tanggal_penjualan)
            )
        )
    ) AS laba_bersih

FROM Penjualan p
GROUP BY strftime('%Y', p.tanggal_penjualan);</sql><current_tab id="1"/></tab_sql></sqlb_project>
